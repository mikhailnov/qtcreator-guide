\section{Структура и редактирование проекта на Qt}

На скриншоте показаны основные элементы окна программы Qt Creator.
\addimghere{qtc21}{1}{Основные элементы окна Qt Creator}{qtc21}

\subsection{Файлы проекта}
В созданном проекте "graqa" есть следующие файлы:

\begin{itemize}
  \item graqa.pro
  \item graqa.cpp
  \item graqa.h
  \item graqa.ui
  \item main.cpp
\end{itemize}

Таким образом, файлы в шаблонном проекте можно разделить на следующие типы:

\begin{itemize}
  \item *.pro — "настройки" сборочной системы qmake, которая является частью Qt и автоматизирует вызов компилятора с нужными параметрами и пр. действия;
  \item *.cpp — непосредственно файлы с кодом на C++;
  \item *.h — заголовочные файлы, которые "встраиваются" в код через include; обычно в них задаются переменные и/или прототипы функций;
  \item *.ui — файл с XML-разметкой, описание элементов графического окна, создается с помощью визуального конструктора в Qt Creator.
\end{itemize}

Обратите внимание, что, если вы видите не все файлы в дереве проекта, то нужно развернуть каждую категорию.

На этапе "Подготовка программного окружения для разработки. Установка Qt Creator" было сказано про установку QCustomPlot. Если вы его установили не из репозитория, а скачали, то в папку с проектом положите файлы qcustomplot.cpp и qcustomplot.h рядом с перечисленными выше файлами проекта. Далее в списке файлов проекта в Qt Creator нажмите правой кнопкой мыши на заголовок проекта и выберите "Добавить существующие файлы", проделав это для обоих файлов. Если вы на Linux/BSD установили QCustomPlot из репозитория, класть/копировать и добавлять файлы не нужно.
\addimghere{qtc24}{1}{Добавление файлов в проект}{qtc24}

Если вы клали файлы qcustomplot.cpp и qcustomplot.h в папку проекта, то после их добавления в проект убедитесь, что в файле *.pro они появились в переменных SOURCES и HEADERS. Должно быть, как на скриншоте ниже. Если это не так, допишите вручную. При любом способе установки qcustomplot нужно "QT += widgets" заменить на "QT += widgets printsupport", т.е. добавить printsupport.
\addimghere{qtc31}{1}{Редактирование инструкций qmake}{qtc31}

Если вы установили qcustomplot из репозитория, то есть если будет использоваться общесистемная библиотека qcustomplot, то откройте файл *.h (например, graqa.h или mainwindow.h), созданный при создании проекта, и в нем после
\begin{lstlisting}[language=c++]
#include <QMainWindow>
\end{lstlisting}
добавьте еще один include, чтобы получилось так:
\begin{lstlisting}[language=c++]
#include <QMainWindow>
#include <qcustomplot.h>
\end{lstlisting}
В *.pro добавьте: "LIBS += -lqcustomplot", как показано на скриншоте ниже (если используется общеситемная или просто готовая библиотека qcustomplot). Это укажет линковщику, что нужно линковаться с библиотекой libqcustomplot.so или libqcustomplot.dll (расширение .so используется на UNIX-подобных ОС, .dll — на Windows).
\addimghere{qtc32}{1}{Добавление инструкции линковаться с qcustomplot.so}{qtc32}

В списке файлов проекта в Qt Creator в категории "Формы" выберем файл *.ui и нажмем на него 2 раза, чтобы открыть для редактирования. Откроется показанный на скриншоте визуальный конструктор.
\addimghere{qtc22}{1}{Визуальный конструктор элементов графического окна}{qtc22}

Слева доступны различные элементы интерфейса, которые можно перетащить в макет окна. Если установлены дополнительные библиотеки Qt, содержащие в себе свои элементы интерфейса, например, Qwt, то эти элементы также доступны для выбора.

В разделе "Containers" зажмем "Widget" левой кнопкой мыши и, не отпуская левую кнопку мыши, перетащим его в свободное место в макете окна, после чего отпустим зажатую кнопку мыши. Что и куда перетащить, показано на скриншоте.
\addimghere{qtc25}{1}{Добавление виджета}{qtc25}

На месте добавленного виджета будет рисоваться график функции. Чтобы размер виджета и графика менялся с изменением размера окна, в окне Qt Creator в списке объектов проектируемого окна нажмите правой кнопкой мыши на корневой объект "Mainwindow", далее выберите "Компоновка" - "Скомпоновать на сетке", как показано на скриншоте.
\addimghere{qtc26}{1}{Компоновка по сетке}{qtc26}

Теперь widget автоматически занял почти всю площадь окна, что можно заметить, нажав на него внутри проектируемого окна и посмотрев границы.
\addimghere{qtc27}{1}{Границы виджета после компоновки по сетке}{qtc27}

Теперь нужно сделать так, чтобы на месте добавленного виджета рисовался график с помощью библиотеки QCustomPlot. Для этого в контструкторе правой кнопкой мыши нажимите на добавленный widget, выберите: "Преобразовать в...", в открывшемся окне напишите "QCustomPlot" в качестве имени преобразованного класса, поле "Заголовочный файл" заполнится автоматически и примет значение qcustomplot.h, галка "Глобальное включение" не нужна. Нажмите "Добавить", затем QCustomPlot появится в списке преобразованных классов над формой добавления преобразования. Окно можно закрывать.
\addimghere{qtc34}{1}{Вызов операции преобразования класса}{qtc34}
\addimghere{qtc30}{1}{Добавление преобразования класса}{qtc30}

Рекомендуется регулярно сохранять внесенные изменения, нажимая "Файл" - "Сохранить всё" (Ctrl+Shift+S).

Для выхода из конструктора можно либо перейти в "Редактор", либо закрыть вкладку, как показано на скриншоте.
\addimghere{qtc23}{1}{Выход из визуального конструктора}{qtc23}

Теперь всё готово к сборке (сборкой называют компиляцию) и запуску первой версии программы. Для этого слева внизу в Qt Creator нажмите кнопку "Запустить". Будут произведены сборка и запуск программы. Откроется окно "MainWindow" с пустым графиком. Это означает, что программа работает.
\addimghere{qtc33}{1}{Первая сборка и запуск}{qtc33}

Если используется система контроля версий (например, Git), то сейчас, когда мы внесли логически целостное изменение — подготовили простейший макет окна будущей программы — стоит зафиксировать изменения, сделав коммит. В меню "Инструменты" выбираем: "Git" - "Локальное хранилище" - "Сравнить". Откроется окно с показом изменений. Файл *.ui — это файл с XML-разметкой, то есть тоже текстовый файл, как и остальной код, поэтому он тоже легко поддается операции построчного сравнения исходного состояния, т.е. состояния на момент предыдущего коммита в git, и текущего. Красным подсвечиваются удаленные строки, зеленым — добавленные. Можно вручную проверить корректность внесенных правок, особенно, елси они были сделаны в программный код, а не в XML-разметку. При работе с git из консоли вместо графической обертки в Qt Creator дял просмотра изменений используйте команду git diff.
\addimghere{qtc28}{1}{git diff в Qt Creator}{qtc28}

После проверки изменений (diff'а) нужно выполнить коммит, т.е. фиксацию изменений. Для этого выберите "Инструменты" - "Git" - "Локальное хранилище" - "Фиксировать (commit)". Справа отметьте файлы, изменения в которых нужно зафиксировать, слева заполните "Описание". Эта процедура уже была рассмотрена ранее в конце раздела "Создание проекта в Qt Creator". Пример приведен на скриншоте.
\addimghere{qtc29}{1}{git commit в Qt Creator}{qtc29}

\clearpage
